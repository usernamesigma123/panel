<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel Administracyjny (LocalStorage)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #f1f1f1;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #4da6ff;
    }
    .hidden { display: none; }
    .card {
      background: #2a2a2a;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
    }
    input, select, button, textarea {
      padding: 8px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      outline: none;
    }
    input, select, textarea {
      width: calc(100% - 20px);
      background: #3a3a3a;
      color: white;
    }
    button {
      background: #4da6ff;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #1e90ff;
    }
    nav button { margin-right: 10px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #555;
      padding: 6px;
      text-align: center;
    }
    .announcement {
      background: #333;
      padding: 10px;
      border-left: 5px solid #4da6ff;
      margin: 5px 0;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Panel Administracyjny</h1>

  <!-- Sekcja logowania -->
  <div id="login-section">
    <h2>Logowanie</h2>
    <button onclick="document.getElementById('login-form').requestSubmit()" style="width:100%;margin-bottom:10px;font-size:18px;">Zaloguj się</button>
    <form id="login-form">
      <input type="text" id="login-username" placeholder="Login" required>
      <input type="password" id="login-password" placeholder="Hasło" required>
      <button type="submit">Zaloguj</button>
    </form>
    <p id="login-error" style="color:red;"></p>
  </div>

  <!-- Sekcja panelu -->
  <div id="panel-section" class="hidden">
    <nav>
      <button onclick="showTab('users')">Użytkownicy</button>
      <button onclick="showTab('plusyminusy')">Plusy/Minusy</button>
      <button onclick="showTab('announcements')">Ogłoszenia</button>
      <button onclick="logout()" style="background:red;">Wyloguj</button>
    </nav>

    <!-- Zakładka użytkowników -->
    <div id="tab-users" class="hidden card">
      <h2>Zarządzanie użytkownikami</h2>
      <div>
        <input id="new-username" placeholder="Login nowego użytkownika">
        <input id="new-displayname" placeholder="Wyświetlana nazwa">
        <select id="new-role">
          <option value="support">Support</option>
          <option value="moderator">Moderator</option>
          <option value="administrator">Administrator</option>
        </select>
        <button onclick="addUser()">Dodaj użytkownika</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Login</th>
            <th>Nazwa</th>
            <th>Rola</th>
            <th>Plusy</th>
            <th>Minusy</th>
            <th>Ostatnia aktywność</th>
            <th>Akcje</th>
          </tr>
        </thead>
        <tbody id="users-table"></tbody>
      </table>
    </div>

    <!-- Zakładka plusów i minusów -->
    <div id="tab-plusyminusy" class="hidden card">
      <h2>System Plusów i Minusów</h2>
      <div>
        <select id="pm-user"></select>
        <button onclick="addPlus()">Dodaj plusa</button>
        <button onclick="addMinus()">Dodaj minusa</button>
      </div>
      <p>Minusy automatycznie przyznawane za 1 dzień nieaktywności.</p>
    </div>

    <!-- Zakładka ogłoszeń -->
    <div id="tab-announcements" class="hidden card">
      <h2>Ogłoszenia</h2>
      <textarea id="announcement-text" placeholder="Treść ogłoszenia"></textarea>
      <button onclick="addAnnouncement()">Dodaj ogłoszenie</button>
      <div id="announcements-list"></div>
    </div>
  </div>
</div>

<script>
  // ------------------ Dane globalne ------------------
  let data = JSON.parse(localStorage.getItem('panelData')) || {
    users: [
      {username:'adminaccountowner', display:'Owner', role:'vowner', plusy:0, minusy:0, lastActive:Date.now()}
    ],
    announcements: []
  };

  function saveData(){
    localStorage.setItem('panelData', JSON.stringify(data));
  }

  // ------------------ Logowanie ------------------
  document.getElementById('login-form').addEventListener('submit', function(e){
    e.preventDefault();
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    if(username === 'adminaccountowner' && password === 'ownerpassword1245'){
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('panel-section').classList.remove('hidden');
      refreshUsersTable();
      refreshPMUserList();
      refreshAnnouncements();
    } else {
      document.getElementById('login-error').innerText = 'Nieprawidłowy login lub hasło!';
    }
  });

  function logout(){
    document.getElementById('panel-section').classList.add('hidden');
    document.getElementById('login-section').classList.remove('hidden');
  }

  // ------------------ Zakładki ------------------
  function showTab(tab){
    document.querySelectorAll('#panel-section > div').forEach(div=>{
      if(div.id.startsWith('tab-')) div.classList.add('hidden');
    });
    document.getElementById('tab-'+tab).classList.remove('hidden');
  }

  // ------------------ Użytkownicy ------------------
  function addUser(){
    const username = document.getElementById('new-username').value.trim();
    const display = document.getElementById('new-displayname').value.trim() || username;
    const role = document.getElementById('new-role').value;

    if(!username) return alert('Podaj login użytkownika');
    if(data.users.find(u=>u.username===username)) return alert('Taki użytkownik już istnieje!');

    data.users.push({username, display, role, plusy:0, minusy:0, lastActive:Date.now()});
    saveData();
    refreshUsersTable();
    refreshPMUserList();
  }

  function refreshUsersTable(){
    const tbody = document.getElementById('users-table');
    tbody.innerHTML = '';
    const now = Date.now();
    data.users.forEach(user=>{
      const diff = now - user.lastActive;
      const status = diff<60000 ? 'Online' :
                     diff<3600000 ? Math.floor(diff/60000)+'m temu' :
                     diff<86400000 ? Math.floor(diff/3600000)+'h temu' :
                     Math.floor(diff/86400000)+'d temu';
      tbody.innerHTML += `
        <tr>
          <td>${user.username}</td>
          <td>${user.display}</td>
          <td>${user.role}</td>
          <td>${user.plusy}</td>
          <td>${user.minusy}</td>
          <td>${status}</td>
          <td>
            <button onclick="promote('${user.username}')">Awans</button>
            <button onclick="demote('${user.username}')">Degradacja</button>
          </td>
        </tr>
      `;
    });
  }

  function promote(username){
    const roles = ['support','moderator','administrator','vowner'];
    const u = data.users.find(x=>x.username===username);
    if(!u) return;
    let idx = roles.indexOf(u.role);
    if(idx<roles.length-1) u.role = roles[idx+1];
    saveData();
    refreshUsersTable();
  }

  function demote(username){
    const roles = ['support','moderator','administrator','vowner'];
    const u = data.users.find(x=>x.username===username);
    if(!u) return;
    let idx = roles.indexOf(u.role);
    if(idx>0) u.role = roles[idx-1];
    saveData();
    refreshUsersTable();
  }

  // ------------------ Plusy / Minusy ------------------
  function refreshPMUserList(){
    const select = document.getElementById('pm-user');
    select.innerHTML = '';
    data.users.forEach(u=>{
      if(u.username !== 'adminaccountowner'){
        select.innerHTML += `<option value="${u.username}">${u.display} (${u.username})</option>`;
      }
    });
  }

  function addPlus(){
    const username = document.getElementById('pm-user').value;
    const user = data.users.find(u=>u.username===username);
    if(user){
      user.plusy++;
      checkPromotion(user);
      saveData();
      refreshUsersTable();
    }
  }

  function addMinus(){
    const username = document.getElementById('pm-user').value;
    const user = data.users.find(u=>u.username===username);
    if(user){
      user.minusy++;
      checkDemotion(user);
      saveData();
      refreshUsersTable();
    }
  }

  function checkPromotion(user){
    if(user.plusy>=5) promote(user.username);
  }

  function checkDemotion(user){
    if(user.minusy>=3) demote(user.username);
  }

  // Automatyczne minusy co 1 dzień offline
  setInterval(()=>{
    const now = Date.now();
    data.users.forEach(user=>{
      if(now - user.lastActive > 86400000){
        user.minusy++;
        checkDemotion(user);
      }
    });
    saveData();
    refreshUsersTable();
  }, 60000); // sprawdzanie co minutę dla testów

  // ------------------ Ogłoszenia ------------------
  function addAnnouncement(){
    const text = document.getElementById('announcement-text').value.trim();
    if(!text) return;
    data.announcements.unshift({text, date:new Date().toLocaleString()});
    saveData();
    refreshAnnouncements();
    document.getElementById('announcement-text').value = '';
  }

  function refreshAnnouncements(){
    const list = document.getElementById('announcements-list');
    list.innerHTML = '';
    data.announcements.forEach(a=>{
      list.innerHTML += `<div class="announcement"><b>${a.date}:</b> ${a.text}</div>`;
    });
  }
</script>
</body>
</html>
